<!--
  @file index.html
  @brief Main web interface for M5Stack Atom relay controller
  @author Steff8583
  @date 02.01.2026
  
  Web UI for controlling auto power-off functionality with live status updates.
  Features:
  - Real-time status monitoring (auto-mode, timer, relay state)
  - Manual relay control (ON/OFF/Toggle)
  - Configurable timer delay (1-240 minutes)
  - Relay IP address configuration
  - WiFi network management and reset
  - Visual feedback with progress bar during countdown
  
  Design: Glass morphism dark theme with Prusa orange (#F96831) accent
  Updates: AJAX polling every 500ms to /api/status endpoint
  Dependencies: Bootstrap 5.3.3, Bootstrap Icons 1.11.3
-->
<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Core One Auto Power Off</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css' rel='stylesheet'>
  <link href='/style.css' rel='stylesheet'>
</head>
<body>
  <div class='card-shell'>
    <div class='glass-card'>
      <div class='card-header-gradient text-white px-4 py-3 d-flex align-items-center justify-content-between'>
        <div>
          <div class='fw-semibold'>Core One Auto Power Off</div>
          <div class='small text-white-50'>Local M5Stack control & timer</div>
        </div>
        <div class='text-end'>
          <div class='status-label'>Device IP</div>
          <div class='status-value small' id='deviceIp'>-</div>
          <div class='status-label mt-1'>WiFi Network</div>
          <div class='status-value small' id='wifiSSID'>-</div>
        </div>
      </div>

      <div class='px-4 pt-3 pb-4'>
        <div class='row g-2 mb-3'>
          <div class='col-4'>
            <div class='badge-soft w-100 d-flex flex-column align-items-start px-3 py-2'>
              <span class='status-label'>Auto power off</span>
              <span id='modeBadge' class='status-value chip chip-auto-off mt-1'>?</span>
            </div>
          </div>
          <div class='col-4'>
            <div class='badge-soft w-100 d-flex flex-column align-items-start px-3 py-2'>
              <span class='status-label'>Timer</span>
              <span id='timerBadge' class='status-value chip bg-secondary text-light mt-1'>?</span>
            </div>
          </div>
          <div class='col-4'>
            <div class='badge-soft w-100 d-flex flex-column align-items-start px-3 py-2'>
              <span class='status-label'>Relay state</span>
              <span id='relayStateBadge' class='status-value chip bg-secondary text-light mt-1'>?</span>
            </div>
          </div>
        </div>

        <div class='d-flex justify-content-between align-items-center mb-1'>
          <span class='status-label'>Remaining time</span>
          <span id='timeRemaining' class='status-value small'>-</span>
        </div>
        <div class='progress mb-4' style='height:9px;'>
          <div id='timerProgress' class='progress-bar' role='progressbar' style='width:0%;'></div>
        </div>

        <div class='d-grid gap-2 mb-2'>
          <button id='btnMode' class='btn btn-pill btn-sm btn-outline-light btn-icon' type='button'>
            <i class='bi bi-clock-history'></i> Toggle auto power off
          </button>
          <button id='btnOffNow' class='btn btn-pill btn-sm btn-outline-light btn-icon' type='button'>
            <i class='bi bi-power'></i> Power OFF
          </button>
          <button id='btnOnNow' class='btn btn-pill btn-sm btn-outline-light btn-icon' type='button'>
            <i class='bi bi-lightning-charge'></i> Power ON
          </button>
          <button id='btnToggle' class='btn btn-pill btn-sm btn-outline-light btn-icon' type='button'>
            <i class='bi bi-arrow-repeat'></i> Power TOGGLE
          </button>
        </div>
        <div class='text-center mt-2'>
          <small class='text-muted'>Updated live from M5 via JSON / AJAX</small>
        </div>
      </div>
    </div>

    <div class='glass-card mt-3'>
      <div class='px-4 pt-3 pb-3'>
        <div class='mb-3'>
          <label class='status-label'>Auto-off Timer (min)</label>
          <input id='timerSlider' type='range' class='form-range' min='1' max='240' value='10'>
          <div class='small'><span id='timerSliderValue'>10</span> min</div>
        </div>
      </div>
    </div>

    <div class='glass-card mt-3'>
      <div class='px-4 pt-3 pb-3'>
        <div class='mb-3'>
          <label class='status-label'>Relay IP Address</label>
          <div class='input-group input-group-sm'>
            <input id='relayIpInput' type='text' class='form-control' placeholder='192.168.188.44' value='' style='background:rgba(15,23,42,0.9);border:1px solid rgba(148,163,184,0.6);color:#e5e7eb;'>
            <button id='btnSaveIp' class='btn btn-outline-light btn-sm' type='button' style='border-radius:0 999px 999px 0;'>
              <i class='bi bi-check-lg'></i> Save
            </button>
          </div>
          <div class='small text-muted mt-1'>Configure target relay device IP</div>
        </div>
      </div>
    </div>

    <div class='glass-card mt-3'>
      <div class='px-4 pt-3 pb-3'>
        <div class='mb-2'>
          <div class='fw-semibold mb-1'>WiFi Configuration</div>
          <div class='small text-muted mb-2'>Hold button for 3 seconds or click below to reset WiFi and reconfigure</div>
          <button id='btnResetWifi' class='btn btn-pill btn-sm btn-outline-danger w-100 btn-icon' type='button'>
            <i class='bi bi-wifi-off'></i> Reset WiFi Settings
          </button>
        </div>
      </div>
    </div>

    <div class='glass-card mt-3'>
      <div class='px-4 pt-3 pb-3'>
        <div class='d-flex justify-content-between align-items-center mb-2'>
          <div>
            <div class='fw-semibold'>Relay status</div>
            <div class='status-label'>Reported from <span id='relayIpDisplay'>-</span></div>
          </div>
          <span id='relayBadge' class='chip bg-secondary text-light'>?</span>
        </div>
        <ul class='list-group list-group-flush small' style='background:transparent;border-radius:12px;'>
          <li class='list-group-item bg-transparent text-light d-flex justify-content-between'>
            <span>Power</span><span id='valPower'>-</span>
          </li>
          <li class='list-group-item bg-transparent text-light d-flex justify-content-between'>
            <span>Ws</span><span id='valWs'>-</span>
          </li>
          <li class='list-group-item bg-transparent text-light d-flex justify-content-between'>
            <span>Temperature</span><span id='valTemp'>-</span>
          </li>
          <li class='list-group-item bg-transparent text-light d-flex justify-content-between'>
            <span>Energy since boot</span><span id='valEnergy'>-</span>
          </li>
          <li class='list-group-item bg-transparent text-light d-flex justify-content-between'>
            <span>Time since boot</span><span id='valTimeBoot'>-</span>
          </li>
        </ul>
        <div class='mt-2 text-end'>
          <small id='valReportState' class='text-muted'>report: unknown</small>
        </div>
      </div>
    </div>

  </div>
  <script src='/app.js'></script>
</body>
</html>
