<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Core One Auto Power Off</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css' rel='stylesheet'>
  <link href='/style.css' rel='stylesheet'>
  <script src='https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js'></script>
</head>
<body>
  <div class='card-shell'>
    <!-- Header -->
    <div class='glass-card'>
      <div class='card-header-gradient text-white px-4 py-3'>
        <div class='d-flex justify-content-between align-items-center'>
          <div>
            <h5 class='mb-0'>Core One Power Control</h5>
            <small class='text-white-50'><i class='bi bi-hdd-network'></i> <span id='deviceIp'>-</span> â€¢ <i class='bi bi-wifi'></i> <span id='wifiSSID'>-</span></small>
          </div>
          <div class='d-flex gap-2'>
            <span id='modeBadge' class='chip chip-auto-off'><i class='bi bi-clock-history'></i></span>
            <span id='relayStateBadge' class='chip bg-secondary'><i class='bi bi-power'></i></span>
          </div>
        </div>
      </div>

      <!-- Warning -->
      <div id='relayWarning' class='alert alert-warning mx-3 mt-3 mb-0' style='display:none; background:rgba(249,104,49,0.15); border:1px solid rgba(249,104,49,0.4); color:#F96831;'>
        <i class='bi bi-exclamation-triangle-fill me-2'></i>
        <strong>Relay Offline:</strong> <span id='relayWarningIp'>-</span>
      </div>

      <!-- Tab Navigation -->
      <ul class='nav nav-pills px-4 pt-3' id='mainTabs' role='tablist'>
        <li class='nav-item' role='presentation'>
          <button class='nav-link active' id='dashboard-tab' data-bs-toggle='pill' data-bs-target='#dashboard' type='button'>
            <i class='bi bi-speedometer2'></i> Dashboard
          </button>
        </li>
        <li class='nav-item' role='presentation'>
          <button class='nav-link' id='logging-tab' data-bs-toggle='pill' data-bs-target='#logging' type='button'>
            <i class='bi bi-graph-up'></i> Logging
          </button>
        </li>
        <li class='nav-item' role='presentation'>
          <button class='nav-link' id='files-tab' data-bs-toggle='pill' data-bs-target='#files' type='button'>
            <i class='bi bi-folder2-open'></i> Files
          </button>
        </li>
        <li class='nav-item' role='presentation'>
          <button class='nav-link' id='settings-tab' data-bs-toggle='pill' data-bs-target='#settings' type='button'>
            <i class='bi bi-gear'></i> Settings
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class='tab-content px-4 pb-4' id='mainTabsContent'>
        
        <!-- Dashboard Tab -->
        <div class='tab-pane fade show active' id='dashboard' role='tabpanel'>
          <div class='pt-3'>
            
            <!-- Timer Progress -->
            <div class='mb-4'>
              <div class='d-flex justify-content-between mb-2'>
                <span class='fw-semibold'><i class='bi bi-hourglass-split'></i> Auto-Off Timer</span>
                <span id='timeRemaining' class='badge bg-secondary'>-</span>
              </div>
              <div class='progress mb-2' style='height:10px;'>
                <div id='timerProgress' class='progress-bar' style='width:0%;'></div>
              </div>
              <input id='timerSlider' type='range' class='form-range' min='1' max='240' value='10'>
              <div class='text-center small text-muted'><span id='timerSliderValue'>10</span> min delay</div>
            </div>

            <!-- Control Buttons -->
            <div class='row g-2 mb-4'>
              <div class='col-6'>
                <button id='btnMode' class='btn btn-outline-light w-100 btn-icon' type='button'>
                  <i class='bi bi-clock-history'></i><br><small>Toggle Auto-Off</small>
                </button>
              </div>
              <div class='col-6'>
                <button id='btnToggle' class='btn btn-outline-light w-100 btn-icon' type='button'>
                  <i class='bi bi-arrow-repeat'></i><br><small>Toggle Power</small>
                </button>
              </div>
              <div class='col-6'>
                <button id='btnOnNow' class='btn btn-success w-100 btn-icon' type='button'>
                  <i class='bi bi-lightning-charge'></i><br><small>Power ON</small>
                </button>
              </div>
              <div class='col-6'>
                <button id='btnOffNow' class='btn btn-danger w-100 btn-icon' type='button'>
                  <i class='bi bi-power'></i><br><small>Power OFF</small>
                </button>
              </div>
            </div>

            <!-- Relay Status -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <div class='d-flex justify-content-between align-items-center mb-2'>
                  <h6 class='mb-0'><i class='bi bi-router'></i> Relay Status</h6>
                  <span id='relayBadge' class='chip bg-secondary'>?</span>
                </div>
                <div class='row g-2 small'>
                  <div class='col-6'>
                    <div class='text-muted'>Power</div>
                    <div class='fw-semibold' id='valPower'>-</div>
                  </div>
                  <div class='col-6'>
                    <div class='text-muted'>Energy</div>
                    <div class='fw-semibold' id='valWs'>-</div>
                  </div>
                  <div class='col-6'>
                    <div class='text-muted'>Temperature</div>
                    <div class='fw-semibold' id='valTemp'>-</div>
                  </div>
                  <div class='col-6'>
                    <div class='text-muted'>Uptime</div>
                    <div class='fw-semibold' id='valTimeBoot'>-</div>
                  </div>
                </div>
                <div class='mt-2 text-end'>
                  <small id='valReportState' class='text-muted'>-</small>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Logging Tab -->
        <div class='tab-pane fade' id='logging' role='tabpanel'>
          <div class='pt-3'>
            
            <!-- Logging Status -->
            <div class='d-flex justify-content-between align-items-center mb-3'>
              <h6 class='mb-0'><i class='bi bi-graph-up'></i> Power Logging</h6>
              <span id='logStatusBadge' class='chip bg-secondary text-light'><i class='bi bi-circle'></i> Idle</span>
            </div>
            
            <!-- Logging Controls -->
            <div class='d-flex gap-2 mb-3'>
              <button id='btnStartLog' class='btn btn-success flex-fill btn-icon' type='button'>
                <i class='bi bi-play-fill'></i> Start
              </button>
              <button id='btnStopLog' class='btn btn-warning flex-fill btn-icon' type='button' disabled>
                <i class='bi bi-stop-fill'></i> Stop
              </button>
              <button id='btnClearLog' class='btn btn-outline-light flex-fill btn-icon' type='button'>
                <i class='bi bi-trash3'></i> Clear
              </button>
            </div>

            <!-- Log Stats -->
            <div id='logStats' class='card bg-dark border-0 mb-3' style='display:none;'>
              <div class='card-body p-3'>
                <div class='row g-2 small'>
                  <div class='col-4 text-center'>
                    <div class='text-muted'>Points</div>
                    <div class='fw-bold' id='logCount'>0</div>
                  </div>
                  <div class='col-4 text-center'>
                    <div class='text-muted'>Duration</div>
                    <div class='fw-bold' id='logDuration'>0m</div>
                  </div>
                  <div class='col-4 text-center'>
                    <div class='text-muted'>Energy</div>
                    <div class='fw-bold' id='logTotalEnergy'>0 Wh</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Chart -->
            <div class='position-relative' style='height:300px;'>
              <canvas id='powerChart'></canvas>
            </div>

          </div>
        </div>

        <!-- Files Tab -->
        <div class='tab-pane fade' id='files' role='tabpanel'>
          <div class='pt-3'>
            
            <!-- Storage Status -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <div class='d-flex justify-content-between align-items-center mb-2'>
                  <h6 class='mb-0'><i class='bi bi-hdd'></i> Storage</h6>
                  <button id='btnRefreshFiles' class='btn btn-sm btn-outline-light btn-icon'>
                    <i class='bi bi-arrow-clockwise'></i>
                  </button>
                </div>
                <div class='small mb-1'>
                  <span id='storageInfo'>Loading...</span>
                </div>
                <div class='progress mb-2' style='height:6px;'>
                  <div id='storageBar' class='progress-bar' style='width:0%;'></div>
                </div>
                <div id='storageWarning' class='alert alert-warning small mb-0' style='display:none;'>
                  <i class='bi bi-exclamation-triangle'></i> <span id='storageWarningText'></span>
                </div>
              </div>
            </div>

            <!-- File List -->
            <div id='fileList' class='mb-3'></div>

            <!-- Save Button -->
            <button id='btnSaveCurrentLog' class='btn btn-outline-light w-100 btn-icon' type='button'>
              <i class='bi bi-save'></i> Save Current Log
            </button>

          </div>
        </div>

        <!-- Settings Tab -->
        <div class='tab-pane fade' id='settings' role='tabpanel'>
          <div class='pt-3'>
            
            <!-- Relay IP -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-router-fill'></i> Relay Configuration</h6>
                <div class='input-group input-group-sm mb-2'>
                  <input id='relayIpInput' type='text' class='form-control' placeholder='192.168.188.44'>
                  <button id='btnSaveIp' class='btn btn-outline-light' type='button'>
                    <i class='bi bi-check-lg'></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Tariff Settings -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-currency-exchange'></i> Energy Tariff</h6>
                <div class='row g-2 mb-2'>
                  <div class='col-4'>
                    <label class='form-label small'>High</label>
                    <input id='tariffHigh' type='number' step='0.01' class='form-control form-control-sm'>
                  </div>
                  <div class='col-4'>
                    <label class='form-label small'>Low</label>
                    <input id='tariffLow' type='number' step='0.01' class='form-control form-control-sm'>
                  </div>
                  <div class='col-4'>
                    <label class='form-label small'>Currency</label>
                    <input id='tariffCurrency' type='text' class='form-control form-control-sm'>
                  </div>
                </div>
                <div class='row g-2 mb-2'>
                  <div class='col-6'>
                    <label class='form-label small'>Low Start</label>
                    <input id='tariffStartHour' type='number' class='form-control form-control-sm'>
                  </div>
                  <div class='col-6'>
                    <label class='form-label small'>Low End</label>
                    <input id='tariffEndHour' type='number' class='form-control form-control-sm'>
                  </div>
                </div>
                <button id='btnSaveTariff' class='btn btn-sm btn-outline-light w-100' type='button'>
                  <i class='bi bi-check-lg'></i> Save
                </button>
              </div>
            </div>

            <!-- Auto-Logging -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-lightning-charge-fill'></i> Auto-Logging</h6>
                <div class='form-check form-switch mb-3'>
                  <input class='form-check-input' type='checkbox' id='autoLogEnabled'>
                  <label class='form-check-label small'>Enable automatic logging</label>
                </div>
                <div class='row g-2 mb-2'>
                  <div class='col-6'>
                    <label class='form-label small'>Threshold (W)</label>
                    <input id='autoLogThreshold' type='number' class='form-control form-control-sm'>
                  </div>
                  <div class='col-6'>
                    <label class='form-label small'>Debounce (s)</label>
                    <input id='autoLogDebounce' type='number' class='form-control form-control-sm'>
                  </div>
                </div>
                <button id='btnSaveAutoLog' class='btn btn-sm btn-outline-light w-100' type='button'>
                  <i class='bi bi-check-lg'></i> Save
                </button>
              </div>
            </div>

            <!-- Log Interval -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-clock-history'></i> Log Interval</h6>
                <div class='mb-2'>
                  <label class='form-label small'>Interval (seconds)</label>
                  <input id='logInterval' type='number' class='form-control form-control-sm'>
                </div>
                <div class='alert alert-info small mb-2' style='background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);'>
                  <i class='bi bi-info-circle'></i> <span id='logDurationInfo'>-</span>
                </div>
                <button id='btnSaveLogInterval' class='btn btn-sm btn-outline-light w-100' type='button'>
                  <i class='bi bi-check-lg'></i> Save
                </button>
              </div>
            </div>

            <!-- Security -->
            <div class='card bg-dark border-0 mb-3'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-shield-lock'></i> Security</h6>
                <div class='mb-2'>
                  <label class='form-label small'>Username</label>
                  <input id='authUsername' type='text' class='form-control form-control-sm'>
                </div>
                <div class='mb-2'>
                  <label class='form-label small'>Password</label>
                  <input id='authPassword' type='password' class='form-control form-control-sm'>
                </div>
                <button id='btnSaveAuth' class='btn btn-sm btn-outline-light w-100' type='button'>
                  <i class='bi bi-shield-check'></i> Update
                </button>
              </div>
            </div>

            <!-- WiFi -->
            <div class='card bg-dark border-0'>
              <div class='card-body p-3'>
                <h6 class='mb-3'><i class='bi bi-wifi'></i> WiFi Configuration</h6>
                <button id='btnResetWifi' class='btn btn-sm btn-outline-danger w-100' type='button'>
                  <i class='bi bi-wifi-off'></i> Reset WiFi
                </button>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
  
  <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js'></script>
  <script src='/app.js'></script>
</body>
</html>
